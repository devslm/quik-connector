[![C++](https://img.shields.io/badge/C++-%2011-green.svg)]()
[![Windows 7/8/10](https://img.shields.io/badge/Windows-7/8/10-blue.svg)](https://www.microsoft.com/)
[![Arqa Quik 8.13+](https://img.shields.io/badge/Arqa%20Quik-8.13+-green.svg)](https://arqatech.com/en/products/quik/)

# C++ Connector for Arqa Quik Terminal

## О проекте
### Важно!
**Т.к. коннектор имеет полный доступ к терминалу, то он может легко выполнить любую операцию (в том числе вывести деньги
со счета), поэтому доверять можно только коду и бинарным файлам, скачанным с данного репозитория!
Я не несу ответственности за код или бинарные файлы, скачанные с других ресурсов!
Все релизные файлы подписываются сертификатом, соответственно я могу проверить при возникающих проблемах оригинальный файл или нет.**

Документация написана на русском языке, т.к. пользователи термина QUIK в основном русскоязычные. Английский вариант
возможно появится в будущем если будет интерес.

Данный коннектор реализует не весь фукционал из документации, только часть самых необходимых функций. Данный коннектор
используется в другом проекте как интерфейс к терминалу.
В качестве транспортной шины используется Redis. Единственная из доступных для Windows (нативно без подсистемы Linux)
in-memory БД. Данный транспорт обеспечивает большое количество плюсов по сравнению, например, с ZeroMQ или Memory Maped
Files (данные решения не являются полноценными очередями, кэшами и БД в одном приложении). Redis же добавляет коннектору
следующие возможности:
  - Позволяет временно (с использованием TTL на запись) кэшировать требуемые данные
  - Позволяет долговременно и персистентно хранить некоторые данные (например, записи о трэйдах хранятся долго и позволяет
    вновь подключаемым клиентам получать их)
  - Механизм Pub/Sub позволяет отправлять широковещательные сообщения всем подключенным клиентам без сохранения

Соответственно каждый клиент может общаться с терминалом через Redis и сам Redis может находиться как на локальной
машине около терминала или на удаленном (выделенном сервере). Последний вариант позволяет получать данные клиентам, 
находящимся на удаленных машинах.

Дополнительно в коннектор встроена поддержка SQLite для локального сохранения всех ордеров. Возможно они могут потребоваться
для каких-либо целей в будущем (например, для истории).

## Документация
[Страница проекта](https://slm-dev.com/quik-connector/)

## Сборка проекта
Перед сборкой необходимо установить следующие компоненты:
  - **Microsoft Visual Studio 2015+**

Все зависимости для сборки закачиваются и собираются автоматически с использованием **Cmake FetchContent** во время
сборки проекта.

Сборка выполняется в 2 этапа:
  1. Сборка Lua библиотеки (добавить ее как зависимость для Cmake FetchContent не получилось)
  2. Сборка DLL библиотеки

### Сборка Lua библиотеки
Для запуска сборки необходимо запустить консоль **Командная строка Native Tools x64**.
В ней перейти в каталог проекта **/<path-to-quik-connector>/lua-5.3.5** и выполнить:
```shell
build.bat
```

Данный скрипт содержит необходимые команды для сборки Lua библиотеки. После компиляции в каталоге build появятся файлы:
  - lua53.dll
  - lua53.lib

### Сборка проекта
Необходимо вернуться в корень проекта. Для сборки необходимо в консоли **Командная строка Native Tools x64** выполнить
следующие команды:
```shell
mkdir build

cd build
 
cmake .. -A x64 -DCMAKE_BUILD_TYPE=release # -DCMAKE_BUILD_TYPE=debug - для версии для дебага
```

Далее в каталоге build будет создан проект для Visual Studio для дальнейшей сборки. 

Далее необходимо в каталоге build открыть файл: quik_connector.sln. В открывшемся проекте необходимо собрать проект:
  - Выбрать тип сборки Release (если выставлена Debug)
  - Запустить сборку командой **Сборка -> Собрать решение**

После полной сборки проекта в корне каталога будет создан каталог quik-connector с требуемой структорой, который необходимо
скопировать в каталог терминала QUIK (либо в любое другое место и в дальнейшем выбрать его в терминале при запуске коннектора).

Структура готового каталога:
```shell
  |-- bin
  |    |-- quik_connector.dll
  |  
  |-- config
  |    |-- config.yml
  |  
  |-- db
  |    |-- migrations
  |    |    |-- *.sql
  |    |
  |    |-- stocks.db
  |  
  |-- logs
  |    |-- *.log
  |  
  |-- quik-connector.lua
```

#### Каталог **logs** и файл БД **stocks.db** будут созданы при первом запуске DLL в QUIK.

Для запуска необходимо в терминале QUIK выбрать в качестве скрипта файл **quik-connector.lua** и выбрать версию Lua 5.3.5.

# Документация в процессе наполнения!!!
